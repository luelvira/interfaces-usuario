<!-- Generate from "2023/10/19 18:46:52" 9b15ed7 with Emacs 27.1 (Org mode 9.3) -->
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta author="Lucas Elvira Martín"/><meta description=""/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://luelvira.github.io/interfaces-usuario/css/code.css"/><link rel="stylesheet" href="https://luelvira.github.io/interfaces-usuario/css/style.css"/><title>Session 6 and 7UI 2023-2024</title></head><body><header class="site-header"><h1>Session 6 and 7</h1><p class="date">Date: October 16, 2023</p><nav class="nav-side"><ul class="nav-categories"><li><a href="https://luelvira.github.io/interfaces-usuario/">Home</a></li><li><a href="https://luelvira.github.io/interfaces-usuario/sessions.html">Theory</a></li><li><a href="https://luelvira.github.io/interfaces-usuario/practice.html">Practice</a></li></ul></nav></header><main class="main-content"><section><article class="post"><p>
:HEADER-ARGS:html: :tangle w06/index.html
:HEADER-ARGS:css: :tangle w06/css/style.css
:HEADER-ARGS:js: :tangle w06/js/main.js
</p>
<div id="outline-container-org9c8c920" class="outline-2">
<h2 id="org9c8c920">Prepare the environment</h2>
<div class="outline-text-2" id="text-org9c8c920">
<p>
As always, we create all the essential files
</p>
<pre>mkdir -p w06/{css,js}
touch w06/index.html
touch w06/js/main.js</pre>
</div>
</div>

<div id="outline-container-org98cf131" class="outline-2">
<h2 id="org98cf131">Create the template</h2>
<div class="outline-text-2" id="text-org98cf131">
<pre>&lt;<span class="org-keyword">!DOCTYPE</span> html&gt;
&lt;<span class="org-function-name">html</span> <span class="org-variable-name">lang</span>=<span class="org-string">"en"</span>&gt;
  &lt;<span class="org-function-name">head</span>&gt;
    &lt;<span class="org-function-name">meta</span> <span class="org-variable-name">charset</span>=<span class="org-string">"UTF-8"</span>/&gt;
    &lt;<span class="org-function-name">title</span>&gt;<span class="org-underline"><span class="org-bold">Document</span></span>&lt;/<span class="org-function-name">title</span>&gt;
    &lt;<span class="org-function-name">meta</span> <span class="org-variable-name">name</span>=<span class="org-string">"viewport"</span> <span class="org-variable-name">content</span>=<span class="org-string">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"stylesheet"</span> <span class="org-variable-name">href</span>=<span class="org-string">"css/style.css"</span> <span class="org-variable-name">type</span>=<span class="org-string">"text/css"</span> <span class="org-variable-name">media</span>=<span class="org-string">"screen"</span>&gt;
  &lt;/<span class="org-function-name">head</span>&gt;
  &lt;<span class="org-function-name">body</span>&gt;</pre>
</div>

<div id="outline-container-org049d9d7" class="outline-3">
<h3 id="org049d9d7">Insert the javascript file</h3>
<div class="outline-text-3" id="text-org049d9d7">
<p>
We add the js file at the end of the body in order of get available all the DOM
elements
</p>

<pre>&lt;<span class="org-function-name">script</span> <span class="org-variable-name">src</span>=<span class="org-string">"js/main.js"</span>&gt;&lt;/<span class="org-function-name">script</span>&gt;
&lt;/<span class="org-function-name">body</span>&gt;
&lt;/<span class="org-function-name">html</span>&gt;</pre>
</div>
</div>
</div>

<div id="outline-container-org28207c9" class="outline-2">
<h2 id="org28207c9">Working with the storage of the browser</h2>
<div class="outline-text-2" id="text-org28207c9">
</div>
<div id="outline-container-org670ee1a" class="outline-3">
<h3 id="org670ee1a">localStorage/sessionStorage vs Cookies</h3>
<div class="outline-text-3" id="text-org670ee1a">
<p>
Both are data that the user browser stores for some time so we can access them
in other sessions. The data are shared in all the pages within the same domain
</p>
</div>

<div id="outline-container-orga6345cb" class="outline-4">
<h4 id="orga6345cb">localStorage/sessionStorage</h4>
<div class="outline-text-4" id="text-orga6345cb">
<p>
The localStorage is a data structure on the browser that allows us to store some
text as key-value. This structure offers the following methods
</p>

<ul class="org-ul">
<li><code>localStorage.getItem(key)</code>: If the key exists, return the value
associated. Otherwise, return <code>undefined</code>.</li>
<li><code>localStorage.setItem(key, value)</code>: Append a new key with the value
associated. If this key, already exists, replace it.</li>
<li><code>localStorage.removeItem(key)</code>: This method removes the item associated with the key passed.</li>
<li><code>localStorage.clear()</code>: Remove all the values stored</li>
</ul>
</div>
</div>

<div id="outline-container-org5283319" class="outline-4">
<h4 id="org5283319">Cookies</h4>
<div class="outline-text-4" id="text-org5283319">
<p>
The cookies are a string stored in the browser. To access it, we use the
<code>document.cookie</code> property. This string is stored as a key-value, separated by a
~; ~ string. This separator works also for the properties of the cookies.
</p>

<p>
Example from <a href="https://www.w3schools.com/js/js_cookies.asp">w3school js cookies</a>
</p>
<pre class="example">
document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
</pre>
</div>
</div>

<div id="outline-container-org9a08d0e" class="outline-4">
<h4 id="org9a08d0e">Implement the API of the localStorage for the cookies</h4>
<div class="outline-text-4" id="text-org9a08d0e">
<p>
We have viewed two approaches to create an Object available to do it. (one
different in each group). With the Object notation, we saw how to create an
Object, define its properties, and access them. This method is more clean if we
only need an instance, like in this case. However, the function notation allows
us to describe the process more clearly.
</p>
</div>


<div id="outline-container-org527663d" class="outline-5">
<h5 id="org527663d">Function process</h5>
<div class="outline-text-5" id="text-org527663d">
<p>
In this example, we use a function as a constructor. To do it, when we call to
it, we have to add the <code>new</code> keyword before the function name.
</p>

<pre><span class="org-keyword">function</span> <span class="org-function-name">MyLocalStorage</span>() {
    <span class="org-constant">this</span>.myStorage = {};
};
<span class="org-keyword">let</span> <span class="org-variable-name">myLocalStorage</span> = <span class="org-keyword">new</span> <span class="org-type">MyLocalStorage</span>();</pre>

<p>
Now we add the four methods with the prototype syntax. The first method we add
is the get item. This method checks if it has the key stored in an auxiliary
data structure. Otherwise, update this structure with the cookies and check
again if the key exists. If not, return the default value.
</p>
</div>

<ul class="org-ul">
<li><a id="org310cb20"></a>Get Item<br />
<div class="outline-text-6" id="text-org310cb20">
<p>
The process to convert the string into and key-value hashmap is the following:
</p>
<ol class="org-ol">
<li>First, convert the string into an Array with the split method</li>
<li>Second, convert the Array into a matrix with dimensions Nx2. This matrix has
the key value tuple in each row.</li>
<li>Finally, Convert the matrix into an Object with the <code>Object.fromEntries</code> method</li>
</ol>


<pre>MyLocalStorage.<span class="org-constant">prototype</span>.getItem = <span class="org-keyword">function</span>(<span class="org-variable-name">key</span>, <span class="org-variable-name">defaultValue</span>) {
    <span class="org-comment-delimiter">// </span><span class="org-comment">Check if we have the item</span>
    <span class="org-keyword">if</span> (<span class="org-constant">this</span>.myStorage[key]) <span class="org-keyword">return</span> <span class="org-constant">this</span>.myStorage[key];
    <span class="org-constant">this</span>.myStorage = Object.fromEntries(
        document.cookie.split(<span class="org-string">"; "</span>) <span class="org-comment-delimiter">// </span><span class="org-comment">return the first array</span>
            .map(cookie =&gt; cookie.split(<span class="org-string">"="</span>)) <span class="org-comment-delimiter">// </span><span class="org-comment">convert the array into the matrix</span>
        );
    <span class="org-keyword">return</span> <span class="org-constant">this</span>.myStorage[key] || defaultValue;
};</pre>
</div>
</li>

<li><a id="org2a2a28a"></a>Set item<br />
<div class="outline-text-6" id="text-org2a2a28a">
<p>
To add a new Item, we append it to our data structure and create the respective
cookie
</p>

<pre>MyLocalStorage.<span class="org-constant">prototype</span>.setItem = <span class="org-keyword">function</span>(<span class="org-variable-name">key</span>, <span class="org-variable-name">value</span>) {
      <span class="org-constant">this</span>.myStorage[key] = value;
      document.cookie = <span class="org-string">`${key}=${value}`</span>;
};</pre>
</div>
</li>

<li><a id="org2189678"></a>Remove item<br />
<div class="outline-text-6" id="text-org2189678">
<p>
To remove a cookie we need to set the expiration date to a moment before the
current one. I used to create a Date instance and set the timestamp to 0
</p>

<pre>MyLocalStorage.<span class="org-constant">prototype</span>.removeItem = <span class="org-keyword">function</span>(<span class="org-variable-name">key</span>) {
    <span class="org-keyword">let</span> <span class="org-variable-name">date</span> = <span class="org-keyword">new</span> <span class="org-type">Date</span>(0);
    date = date.toUTCString();
      document.cookie = <span class="org-string">`${key}=null;expires=${date}`</span>;
      <span class="org-keyword">delete</span> myLocalStorage[key];
};</pre>
</div>
</li>

<li><a id="orgffd01ed"></a>Clear<br />
<div class="outline-text-6" id="text-orgffd01ed">
<p>
To remove all the elements, we can iter over our Object and call the <code>removeItem</code> method
</p>

<pre>MyLocalStorage.<span class="org-constant">prototype</span>.clear = <span class="org-keyword">function</span>() {
    <span class="org-keyword">for</span> (<span class="org-keyword">let</span> <span class="org-variable-name">key</span> of Object.keys(<span class="org-constant">this</span>.myStorage))
        <span class="org-constant">this</span>.removeItem(key);
};</pre>
</div>
</li>

<li><a id="orgd2c683e"></a>All together<br />
<div class="outline-text-6" id="text-orgd2c683e">
<p>
We can use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures">clousure</a> technique to simulate to have a private attribute
</p>

<pre><span class="org-keyword">function</span> <span class="org-function-name">MyLocalStorage2</span>() {
    <span class="org-keyword">const</span> <span class="org-variable-name">update</span> = () =&gt; Object.fromEntries(document.cookie.split(<span class="org-string">"; "</span>).map(s =&gt; s.split(<span class="org-string">"="</span>)));
    <span class="org-keyword">let</span> <span class="org-variable-name">myStorage</span> = update();
    <span class="org-constant">this</span>.getItem = <span class="org-keyword">function</span>(<span class="org-variable-name">key</span>, <span class="org-variable-name">defaultValue</span>) {
        <span class="org-keyword">if</span> (key <span class="org-keyword">in</span> myStorage) <span class="org-keyword">return</span> myStorage[key];
        myStorage = update();
        <span class="org-keyword">return</span> myStorage[key] || defaultValue;
    };

    <span class="org-constant">this</span>.setItem = <span class="org-keyword">function</span>(<span class="org-variable-name">key</span>, <span class="org-variable-name">value</span>) {
        myStorage[key] = value;
        document.cookie = <span class="org-string">`${key}=${value}`</span>;
    };

    <span class="org-constant">this</span>.removeItem = <span class="org-keyword">function</span>(<span class="org-variable-name">key</span>) {
        <span class="org-keyword">let</span> <span class="org-variable-name">date</span> = <span class="org-keyword">new</span> <span class="org-type">Date</span>(0);
        date.toUTCString();
        document.cookie = <span class="org-string">`${key}=null;expires=${date}`</span>;
        <span class="org-keyword">delete</span> myLocalStorage[key];
    }
    <span class="org-constant">this</span>.clear = <span class="org-keyword">function</span>() {
        <span class="org-keyword">for</span> (<span class="org-keyword">let</span> <span class="org-variable-name">key</span> of Object.keys(myStorage)) {
            <span class="org-constant">this</span>.removeItem(key);
        }
    }
};

<span class="org-keyword">let</span> <span class="org-variable-name">myLocalStorage2</span> = <span class="org-keyword">new</span> <span class="org-type">MyLocalStorage2</span>();</pre>
</div>
</li>
</ul>
</div>

<div id="outline-container-org7471ea9" class="outline-5">
<h5 id="org7471ea9">With the Object notation</h5>
<div class="outline-text-5" id="text-org7471ea9">
<pre><span class="org-keyword">const</span> <span class="org-variable-name">cookiesOperations</span> = {
    listOfCookies: Object.fromEntries(document.cookie.split(<span class="org-string">"; "</span>).map(co =&gt; co.split(<span class="org-string">"="</span>))),

    setItem(key, value) {
        <span class="org-constant">this</span>.listOfCookies[key] = value;
        document.cookie = <span class="org-string">`${key}=${value}`</span>;
    },

    getItem(key, defaultValue) {
        <span class="org-comment-delimiter">// </span><span class="org-comment">return this.listOfCookies[key] if this.listOfCookies[key] else defaultValue</span>
        <span class="org-keyword">return</span> <span class="org-constant">this</span>.listOfCookies[key] ? <span class="org-constant">this</span>.listOfCookies[key] : defaultValue;
    },

    remove(key) {
        <span class="org-keyword">delete</span> <span class="org-constant">this</span>.listOfCookies[key];
        document.cookie = <span class="org-string">`${key}=null; expires=${(() =&gt; new Date(0))().toUTCString()}`</span>;
    },

    clear() {
        <span class="org-keyword">for</span> (<span class="org-keyword">let</span> <span class="org-variable-name">key</span> <span class="org-keyword">in</span> <span class="org-constant">this</span>.listOfCookies)
             <span class="org-constant">this</span>.remove(key);
    },
}</pre>

<p>
But&#x2026; What happens if the cookie has some properties?
</p>
</div>
</div>
</div>
</div>
</div>
</article></section></main><footer class="footer-site"><div class="copyright"><p>© 2023-2024 Lucas Elvira Martín <br/><a href="mailto:luelvira@pa.uc3m.es">luelvira@pa.uc3m.es</a></p></div><div class="Generated"><p>Generated with Emacs 27.1 (Org mode 9.3)</p></div><div class="colabore"><a href="https://github.com/luelvira/interfaces-usuario/" target="_blank"><img src="https://luelvira.github.io/interfaces-usuario/img/github-mark-white.png" alt="Link to the github repository"/></a></div></footer></body></html>
